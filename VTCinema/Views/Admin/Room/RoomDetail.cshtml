
@{
    Layout = null;
}

<div id="headerPopup_CustomerCare" class="header">
    Phòng
</div>
<div class="row">
    <div class="sixteen wide tablet eight wide computer column">
        <div class="ui segments">
            <form class="ui form segment form3" id="form3">
                <div class="ui accordion field">
                    <div class="content field active">
                        <div class="two fields">
                            <div class="field">
                                <label>Tên Phòng</label>
                                <input id="txtNameRoom" name="NameRoom" type="text" />
                            </div>
                            <div class="field">
                                <label>Chi Nhánh</label>
                                <div class="ui fluid search selection dropdown" id="Branch">
                                    <input type="hidden" name="country">
                                    <i class="dropdown icon"></i>
                                    <div class="default text">Chọn Quốc Tịch</div>
                                    <div class="menu" id="cbbBranch">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="row">
    <div class="ui internally celled grid">
        <div class="row">
            <div class="sixteen wide column">
                <div class="row">
                    @*<div class="exit exit--front fuselage">
                    </div>*@ 
                    <ol class="cabin fuselage" id="RoomChairBody">
                    </ol>
                    @*<div class="exit exit--back fuselage">
                    </div>*@
                </div>
            </div>
            @*<div class="three wide column">
                
            </div>*@
        </div>
    </div>
</div>

    <div class="actions">
        <div style="float: right">
            <button class="ui teal button" form="form3" type="submit" onclick="return ExcuteData()">Save</button>

        </div>
        <div style="float: right">
            <button class="ui grey button"  onclick="event.preventDefault();CloseModal()">Cancel</button>
        </div>
    </div>
    <script src="/js/customjs/custom-validation.js"></script>
    <script src="/js/main.js"></script>
    <script>

    let RoomDetailID;
    let DataBranch;

    $(document).ready(function () {
        RoomDetailID = @ViewBag.RoomID;
        LoadDataUpdateRoom();
    });

    function LoadDataUpdateRoom() {
        $.ajax({
            type: 'GET',
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            url: "/Admin/RoomDetail/GetRoomDetail/" + RoomDetailID,
            async: true,
            success: function (result) {
                DataBranch = result.Branch;
                LoadCombo(DataBranch,'cbbBranch');
                let data = result.Table1;                
                if (data.length != 0) {
                    $('#txtNameRoom').val((data[0].Name));
                    $("#Branch").dropdown("refresh");
                    $("#Branch").dropdown("set selected", data[0].BranchID);
                    LoadRoomChair(RoomDetailID);
                }
            }
        });
    }
    function LoadRoomChair(RoomID) {
        $.ajax({
            type: 'GET',
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            url: "/Admin/RoomDetail/GetRoomChairDetail/" + RoomID,
            async: true,
            success: function (result) {
                let NameRow = result.Table;
                let Chair = result.Table1;
                RenderRoomChair(NameRow, Chair,"RoomChairBody")
            }
        });
    }
    function RenderRoomChair(RowChair, Chair, id) {         
        var myNode = document.getElementById(id);
        if (myNode != null) {
            myNode.innerHTML = '';
            let stringContent = '';
            if (Chair && Chair.length > 0) {
                for (var i = 0; i < RowChair.length; i++) {
                    let rc = RowChair[i];
                    let items = Chair.filter(data => data.RowChair == RowChair[i].ID);
                    let tr = '<li class="seat"><label for="' + rc.NameRow +'">' + rc.NameRow +'</label></li>';
                    for (var j = 0; j < items.length; j++) {
                        items = items.sort(function (a, b) { return a.ColumnChair - b.ColumnChair; })
                        item = items[j];
                        tr += '<li class="seat" style="visibility:' + item.VisibilityChair + ';flex-grow:' + item.Total + ';max-width:calc(50px * ' + item.Total + ')" >'
                            + '<input type="checkbox" value="' + item.NameRow + '" id="' + item.NameRow + item.ColumnChair + '" ' + item.DisabledChair + '/>'
                            + '<label for="' + item.NameRow + item.ColumnChair + '" style="background:' + item.ColorCode + '">' + item.NameRow + item.ColumnChair + '</label> </li>'
                    }
                    tr += '<li class="seat"><button type="button" class="AddNewRowChair"><i class="plus circle icon" style="font-size: 30px;color: green;transition:0.5s;"></i></button></li>';
                    stringContent = stringContent + '<li class="row"><ol class="seats" type="' + rc.NameRow + '">' + tr + '</ol></li>';
                    if (i == RowChair.length - 1) {
                        stringContent += '<li class="row"><ol class="seats"><li class="seat"><button type="button" class="AddNewRowChair"><i class="plus circle icon" style="font-size: 30px;color: green;transition:0.5s;"></i></button></li></ol></li>'
                    }
                }
            }
            document.getElementById(id).innerHTML = stringContent;
        }
    }
    function ExcuteData() {
        var data = new Object();
        data.Room = $('#txtNameRoom').val() ? $('#txtNameRoom').val() : "";
        data.BranchID = $("#Branch").dropdown('get value') ? Number($("#Branch").dropdown('get value')) : 0;
        
        $('#form3').form('validate form');
        if ($('#form3').form('is valid')) {

             $.ajax({
                 url: "/Admin/RoomDetail/Execute",
                 dataType: "json",
                 type: "POST",
                 data: {
                     __RequestVerificationToken: token
                     , RoomID: @ViewBag.RoomID
                     , data: JSON.stringify(data)
                 },
                 async: true,
                 error: function (XMLHttpRequest, textStatus, errorThrown) {
                        notiError("Lỗi Hệ Thống");
                 },
                 success: function (result) {
                     if (result == "0") {
                         notiSuccess();
                         LoadRoom();
                     } else {
                         notiError("Lứa Tuổi Đã Tồn Tại Vui Lòng Kiểm Tra Lại");
                        }
                 }
             })
             $('#divDetailPopup').modal('hide');
        }
         return false;
        }

    </script>
    <style>
        .plane {
            margin: 20px auto;
            max-width: 300px;
        }

        .cockpit {
            height: 250px;
            position: relative;
            overflow: hidden;
            text-align: center;
            border-bottom: 5px solid #d8d8d8;
        }

            .cockpit:before {
                content: "";
                display: block;
                position: absolute;
                top: 0;
                left: 0;
                height: 500px;
                width: 100%;
                border-radius: 50%;
                border-right: 5px solid #d8d8d8;
                border-left: 5px solid #d8d8d8;
            }

            .cockpit h1 {
                width: 60%;
                margin: 100px auto 35px auto;
            }

        .exit {
            position: relative;
            height: 50px;
        }

            .exit:before, .exit:after {
                content: "EXIT";
                font-size: 14px;
                line-height: 18px;
                padding: 0px 2px;
                font-family: "Arial Narrow", Arial, sans-serif;
                display: block;
                position: absolute;
                background: green;
                color: white;
                top: 50%;
                transform: translate(0, -50%);
            }

            .exit:before {
                left: 0;
            }

            .exit:after {
                right: 0;
            }

        .fuselage {
            border-right: 5px solid #d8d8d8;
            border-left: 5px solid #d8d8d8;
        }

        ol {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .seats {
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            justify-content: flex-start;
        }

        .seat {
            display: flex;
            /*flex: 0 0 14.2857142857%;*/
            padding: 5px;
            position: relative;
            max-width:50px;
        }
        .seats .seat:nth-child(1){
            flex-grow:1;
        }
        .seat input[type="checkbox"] {
            position: absolute;
            opacity: 0;
        }

                .seat input[type="checkbox"]:checked + label {
                    background: #bada55 !important;
                    -webkit-animation-name: rubberBand;
                    animation-name: rubberBand;
                    animation-duration: 300ms;
                    animation-fill-mode: both;
                }

                .seat input[type="checkbox"]:disabled + label {
                    background: #ddd;
                    text-indent: -9999px;
                    overflow: hidden;
                }

                    .seat input[type="checkbox"]:disabled + label:after {
                        content: "X";
                        text-indent: 0;
                        position: absolute;
                        top: 4px;
                        left: 50%;
                        transform: translate(-50%, 0%);
                    }

                    .seat input[type="checkbox"]:disabled + label:hover {
                        box-shadow: none;
                        cursor: not-allowed;
                    }

            .seat label {
                display: block;
                position: relative;
                width: 100%;
                text-align: center;
                font-size: 14px;
                font-weight: bold;
                line-height: 1.5rem;
                padding: 4px 0;
                background: #f42536;
                border-radius: 5px;
                animation-duration: 300ms;
                animation-fill-mode: both;
            }

                .seat label:before {
                    content: "";
                    position: absolute;
                    width: 75%;
                    height: 75%;
                    top: 1px;
                    left: 50%;
                    transform: translate(-50%, 0%);
                    background: rgba(255, 255, 255, 0.4);
                    border-radius: 3px;
                }

                .seat label:hover {
                    cursor: pointer;
                    box-shadow: 0 0 0px 2px #5c6aff;
                }
        .AddNewRowChair {
            padding: 0;
            border: none;
            background-color: transparent;
            outline:none;
        }
            .AddNewRowChair:hover i{
                transform:rotate(90deg);
                
            }
            .AddNewRowChair:focus i{
                    color:darkgreen;
            }
            @@-webkit-keyframes rubberBand {
                0% {
                -webkit-transform: scale3d(1, 1, 1);
                transform: scale3d(1, 1, 1);
            }

            30% {
                -webkit-transform: scale3d(1.25, 0.75, 1);
                transform: scale3d(1.25, 0.75, 1);
            }

            40% {
                -webkit-transform: scale3d(0.75, 1.25, 1);
                transform: scale3d(0.75, 1.25, 1);
            }

            50% {
                -webkit-transform: scale3d(1.15, 0.85, 1);
                transform: scale3d(1.15, 0.85, 1);
            }

            65% {
                -webkit-transform: scale3d(0.95, 1.05, 1);
                transform: scale3d(0.95, 1.05, 1);
            }

            75% {
                -webkit-transform: scale3d(1.05, 0.95, 1);
                transform: scale3d(1.05, 0.95, 1);
            }

            100% {
                -webkit-transform: scale3d(1, 1, 1);
                transform: scale3d(1, 1, 1);
            }
        }

        @@keyframes rubberBand {
            0% {
                -webkit-transform: scale3d(1, 1, 1);
                transform: scale3d(1, 1, 1);
            }

            30% {
                -webkit-transform: scale3d(1.25, 0.75, 1);
                transform: scale3d(1.25, 0.75, 1);
            }

            40% {
                -webkit-transform: scale3d(0.75, 1.25, 1);
                transform: scale3d(0.75, 1.25, 1);
            }

            50% {
                -webkit-transform: scale3d(1.15, 0.85, 1);
                transform: scale3d(1.15, 0.85, 1);
            }

            65% {
                -webkit-transform: scale3d(0.95, 1.05, 1);
                transform: scale3d(0.95, 1.05, 1);
            }

            75% {
                -webkit-transform: scale3d(1.05, 0.95, 1);
                transform: scale3d(1.05, 0.95, 1);
            }

            100% {
                -webkit-transform: scale3d(1, 1, 1);
                transform: scale3d(1, 1, 1);
            }
        }

        .rubberBand {
            -webkit-animation-name: rubberBand;
            animation-name: rubberBand;
        }
    </style>
