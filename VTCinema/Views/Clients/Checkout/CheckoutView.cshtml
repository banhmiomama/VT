@{
    ViewData["Title"] = "Checkout";
    Layout = "~/Views/Shared/ClientMaster.cshtml";
}

@section Style{
    <style>
        .plane {
            margin: 20px auto;
            max-width: 300px;
        }

        .cockpit {
            height: 250px;
            position: relative;
            overflow: hidden;
            text-align: center;
            border-bottom: 5px solid #d8d8d8;
        }

            .cockpit:before {
                content: "";
                display: block;
                position: absolute;
                top: 0;
                left: 0;
                height: 500px;
                width: 100%;
                border-radius: 50%;
                border-right: 5px solid #d8d8d8;
                border-left: 5px solid #d8d8d8;
            }

            .cockpit h1 {
                width: 60%;
                margin: 100px auto 35px auto;
            }

        .exit {
            position: relative;
            height: 50px;
        }

            .exit:before, .exit:after {
                content: "EXIT";
                font-size: 14px;
                line-height: 18px;
                padding: 0px 2px;
                font-family: "Arial Narrow", Arial, sans-serif;
                display: block;
                position: absolute;
                background: green;
                color: white;
                top: 50%;
                transform: translate(0, -50%);
            }

            .exit:before {
                left: 0;
            }

            .exit:after {
                right: 0;
            }

        .fuselage {
            border-right: 5px solid #d8d8d8;
            border-left: 5px solid #d8d8d8;
        }

        ol {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .seats {
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            justify-content: flex-start;
            width: 100%;
        }

        .seat {
            display: flex;
            /*flex: 0 0 14.2857142857%;*/
            padding: 5px;
            position: relative;
            max-width: 50px;
        }

        .seats .seat:nth-child(1) {
            flex-grow: 1;
            margin-right: 30px;
        }

        .seat input[type="checkbox"] {
            position: absolute;
            opacity: 0;
        }

            .seat input[type="checkbox"]:checked + label {
                background: #bada55 !important;
                -webkit-animation-name: rubberBand;
                animation-name: rubberBand;
                animation-duration: 300ms;
                animation-fill-mode: both;
            }

            .seat input[type="checkbox"]:disabled + label {
                background: #ddd;
                text-indent: -9999px;
                overflow: hidden;
            }

                .seat input[type="checkbox"]:disabled + label:after {
                    content: "X";
                    text-indent: 0;
                    position: absolute;
                    top: 4px;
                    left: 50%;
                    transform: translate(-50%, 0%);
                }

                .seat input[type="checkbox"]:disabled + label:hover {
                    box-shadow: none;
                    cursor: not-allowed;
                }

        .seat label {
            display: block;
            position: relative;
            width: 100%;
            text-align: center;
            font-size: 14px;
            font-weight: bold;
            line-height: 1.5rem;
            padding: 4px 0;
            background: #ffffff;
            border-radius: 5px;
            animation-duration: 300ms;
            animation-fill-mode: both;
        }

            .seat label:before {
                content: "";
                position: absolute;
                width: 75%;
                height: 75%;
                top: 1px;
                left: 50%;
                transform: translate(-50%, 0%);
                background: rgba(255, 255, 255, 0.4);
                border-radius: 3px;
            }

            .seat label:hover {
                cursor: pointer;
                box-shadow: 0 0 0px 2px #5c6aff;
            }

        .AddNewRowChair {
            padding: 0;
            border: none;
            background-color: transparent;
            outline: none;
        }

            .AddNewRowChair:hover i {
                transform: rotate(90deg);
            }

            .AddNewRowChair:focus i {
                color: darkgreen;
            }

        @@-webkit-keyframes rubberBand {
            0% {
                -webkit-transform: scale3d(1, 1, 1);
                transform: scale3d(1, 1, 1);
            }

            30% {
                -webkit-transform: scale3d(1.25, 0.75, 1);
                transform: scale3d(1.25, 0.75, 1);
            }

            40% {
                -webkit-transform: scale3d(0.75, 1.25, 1);
                transform: scale3d(0.75, 1.25, 1);
            }

            50% {
                -webkit-transform: scale3d(1.15, 0.85, 1);
                transform: scale3d(1.15, 0.85, 1);
            }

            65% {
                -webkit-transform: scale3d(0.95, 1.05, 1);
                transform: scale3d(0.95, 1.05, 1);
            }

            75% {
                -webkit-transform: scale3d(1.05, 0.95, 1);
                transform: scale3d(1.05, 0.95, 1);
            }

            100% {
                -webkit-transform: scale3d(1, 1, 1);
                transform: scale3d(1, 1, 1);
            }
        }

        @@keyframes rubberBand {
            0% {
                -webkit-transform: scale3d(1, 1, 1);
                transform: scale3d(1, 1, 1);
            }

            30% {
                -webkit-transform: scale3d(1.25, 0.75, 1);
                transform: scale3d(1.25, 0.75, 1);
            }

            40% {
                -webkit-transform: scale3d(0.75, 1.25, 1);
                transform: scale3d(0.75, 1.25, 1);
            }

            50% {
                -webkit-transform: scale3d(1.15, 0.85, 1);
                transform: scale3d(1.15, 0.85, 1);
            }

            65% {
                -webkit-transform: scale3d(0.95, 1.05, 1);
                transform: scale3d(0.95, 1.05, 1);
            }

            75% {
                -webkit-transform: scale3d(1.05, 0.95, 1);
                transform: scale3d(1.05, 0.95, 1);
            }

            100% {
                -webkit-transform: scale3d(1, 1, 1);
                transform: scale3d(1, 1, 1);
            }
        }

        .rubberBand {
            -webkit-animation-name: rubberBand;
            animation-name: rubberBand;
        }

        .p-title {
            
            box-sizing: border-box;
            font-size: 14px;
            margin-left: 0;
            margin-right: 0;
            padding-bottom: 7.5px;
            color:white;
        }
        .border-dashed {
            border-bottom: 1px dashed #e9e9e9;
        }
        .strong {
            color: #ffffff;
            background-color: red;
            font-size: 20px;
            padding: 0 5px;
            border-radius: 0.25em;
        }
    </style>
}
<!-- content -->
<section class="section details">
    <div class="container">
        <div class="row">
            <div class="col-12 col-lg-8 col-xl-8">
                <!-- content tabs -->
                <img src="~/Clients/img/screen.png" style="max-width:100%;" />
                <div class="tab-content" id="RoomChairBody">

                </div>
                <!-- end content tabs -->
            </div>

            <!-- sidebar -->
            <div class="col-12 col-lg-4 col-xl-4">
                <div class="row">
                    <!-- section title -->
                    <div class="col-12 ">
                        <h2 class="section__title section__title--sidebar" style="font-size:18px;margin-bottom:10px" id="TitleMoive">
                            <strong class="strong">VTCINEMA</strong> Giải Cứu Cây Ước Nguyện
                            The Wishmas Tree
                        </h2>
                        <p class="p-title" id="Address">
                            CGV - Crescent Mall
                        </p>
                        <p class="p-title border-dashed" id="ShowTime">Thứ tư 08/07/2020 - 19:30 - Cinema 7</p>
                    </div>
                    <!-- end section title -->
                    <div class="col-12 ">
                        <div class="row">
                            <p class="p-title col-sm-6 border-dashed">Ghế:<span id="Chair">qưe</span></p>
                            <p class="p-title col-sm-6 border-dashed" id="PriceChair" style="text-align:right">120000</p>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="row">
                            <p class="p-title col-sm-6">Combo:<span id="Combo"></span></p>
                            <p class="p-title col-sm-6" id="PriceCombo" style="text-align:right">120000</p>
                        </div>

                    </div>
                </div>
            </div>
            <!-- end sidebar -->
        </div>
    </div>
</section>
<!-- end content -->

@section Script{
    <script>
        var ScheduleID = @ViewBag.ScheduleDetailID;
        var DataBill = [];
        var PriceTicketType = 0;
        $(document).ready(function () {
            LoadDataScheduleMovie();
            
        });
        function clickLabel() {
            $(".seat label").click(function () {
                if (DataBill.length == 8){

                }
                var NameChair = $(this).attr("for");
                $('#' + NameChair).prop('checked',function () {
                    var idChair = $(this).attr('data-chair');
                    if (removeItemsById(DataBill, idChair) == 0) {
                        var rowchair = Number($(this).parent().parent().attr('data-rowchair'));
                        var price = $(this).attr('data-price');
                        var typeChair = $(this).attr('data-typechair');
                        var item = {
                            NameChair: NameChair,
                            RowChair: rowchair,
                            Chair: idChair,
                            Price: price,
                            TypeChair: typeChair,
                        };
                        DataBill.push(item);                       
                    }
                    RenderPrice(DataBill, "Chair", "PriceChair");
                });              
            });
        }
        function RenderPrice(data, idNameChair, idPriceChair) {
            debugger
            var idChair = document.getElementById(idNameChair);
            var idPrice = document.getElementById(idPriceChair);
            if (idChair != null && idPrice != null) {
                idChair.innerHTML = '';
                idPrice.innerHTML = '';
                let PriceTicket = 0;
                let StringChair = '';
                if (data && data.length > 0) {
                    for (var i = 0; i < data.length; i++) {
                        var item = data[i];
                        PriceTicket += Number(item.Price) + Number(PriceTicketType);
                        StringChair += item.NameChair + ',';
                    }
                }
                document.getElementById(idNameChair).innerHTML = StringChair;
                document.getElementById(idPriceChair).innerHTML = PriceTicket;
            }
            
        }
        function removeItemsById(arr, id) {
            var LengthArr = arr.length;
            var result = 0;
            if (LengthArr > 0) {
                while (--LengthArr) {
                    var ChairId = arr[LengthArr];
                    if (Number(ChairId.Chair) == Number(id)) {
                        arr.splice(LengthArr, 1);
                        result = 1;
                        return result;
                    }
                }
            }
            return result;
        }
        function LoadDataScheduleMovie() {
            $.ajax({
                type: 'GET',
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                url: "/Checkout/ScheduleMovie/" + ScheduleID,
                async: true,
                success: function (result) {
                    let DataMovie = result.Table;
                    if (DataMovie.length > 0) {
                        $('#TitleMoive').html('<strong class="strong">' + DataMovie[0].TicketType + '</strong> ' + DataMovie[0].MovieName);
                        $('#Address').text(DataMovie[0].Address);
                        $('#ShowTime').text(DataMovie[0].ShowTime);
                        PriceTicketType = DataMovie[0].PriceTicketType;
                    }
                    let NameRow = result.Table1;
                    let Chair = result.Table2;
                    RenderRoomChair(NameRow, Chair, "RoomChairBody");
                    clickLabel();
                }
            });
        }
        function RenderRoomChair(RowChair, Chair, id) {
            var myNode = document.getElementById(id);
            if (myNode != null) {
                myNode.innerHTML = '';
                let stringContent = '';
                if (Chair && Chair.length > 0) {
                    for (var i = 0; i < RowChair.length; i++) {
                        let rc = RowChair[i];
                        let items = Chair.filter(data => data.RowChair == RowChair[i].ID);
                        let tr = '<li class="seat"><label for="' + rc.NameRow + '">' + rc.NameRow + '</label></li>';
                        for (var j = 0; j < items.length; j++) {
                            items = items.sort(function (a, b) { return a.ColumnChair - b.ColumnChair; })
                            item = items[j];
                            tr += '<li class="seat" style="visibility:' + item.VisibilityChair + ';flex-grow:' + item.Total + ';max-width:calc(40px * ' + item.Total + ')" >'
                                + '<input type="checkbox" data-typechair="' + item.TypeChairID + '" data-chair="' + item.ID + '" value="' + item.NameRow + '" data-price="' + item.PriceChair + '" id="' + item.NameRow + item.ColumnChair + '" ' + item.DisabledChair + '/>'
                                + '<label for="' + item.NameRow + item.ColumnChair + '" style="background:' + item.ColorCode + '"></label></li>'
                        }
                        stringContent = stringContent + '<li class="row"><ol class="seats" data-rowchair="'+rc.ID+'" type="' + rc.NameRow + '">' + tr + '</ol></li>';
                    }
                }
                document.getElementById(id).innerHTML = stringContent;
            }
        }
    </script>

    
}